{"ignition":{"version":"3.4.0"},"passwd":{"users":[{"groups":["root"],"name":"root","sshAuthorizedKeys":["ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDFPly2MYEeh4FtFtftOa0qasGW4VNIzYv/ZzheQ/dFs martin@fedora"]}]},"storage":{"directories":[{"path":"/etc/ucore-autorebase","mode":492}],"files":[{"path":"/etc/yum.repos.d/telegraf.repo","contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/4SMzcrCMBAA73mKfYE2fPBRROjNi1c9ipRtujYhvyRbad5eWpAePc4wzMOEl1vWCRmfIqAn6OG6qwsywo1SLIZjrtDAnXF0JEYstGQHPWjmVM5S5q1qj1Oropdlr+V66obuX3o0QVDY1AQ9/Ik5zUqTsl+wVH8dD2wwK23eNKjoE3JrqYpPAAAA//9U0uFgygAAAA=="},"mode":493},{"path":"/etc/profile.d/zz-defaults.sh","contents":{"compression":"","source":"data:,export%20EDITOR%3Dvim%0A"}},{"path":"/etc/profile.d/zz-openbao.sh","contents":{"compression":"","source":"data:,export%20VAULT_ADDR%3Dhttps%3A%2F%2Fopenbao.hnatekmar.xyz%0Aexport%20BAO_ADDR%3Dhttps%3A%2F%2Fopenbao.hnatekmar.xyz"},"mode":493},{"path":"/etc/proxy.env","contents":{"compression":"","source":"data:,http_proxy%3D%22http%3A%2F%2F172.16.100.61%3A3128%22"},"mode":420}],"links":[{"path":"/etc/localtime","target":"../usr/share/zoneinfo/Europe/Prague"}]},"systemd":{"units":[{"mask":true,"name":"docker.service"},{"contents":"[Unit]\nDescription=Layer vim with rpm-ostree\nWants=network-online.target\nAfter=network-online.target\n# We run before `zincati.service` to avoid conflicting rpm-ostree\n# transactions.\nBefore=zincati.service\nConditionPathExists=!/var/lib/base-packages-installed.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\n# `--allow-inactive` ensures that rpm-ostree does not return an error\n# if the package is already installed. This is useful if the package is\n# added to the root image in a future Fedora CoreOS release as it will\n# prevent the service from failing.\nExecStart=/usr/bin/rpm-ostree install --allow-inactive -y https://github.com/openbao/openbao/releases/download/v2.1.0/bao_2.1.0_linux_amd64.rpm\nExecStart=/usr/bin/rpm-ostree install --allow-inactive -y vim python3-pip telegraf\nExecStart=/bin/touch /var/lib/base-packages-installed.stamp\nExecStart=/bin/systemctl --no-block reboot\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"rpm-ostree-install-base.service"},{"dropins":[{"contents":"[Service]\nEnvironmentFile=/etc/proxy.env\n","name":"99-proxy.conf"}],"enabled":true,"name":"containerd.service"},{"contents":"[Unit]\nDescription=uCore autorebase to unsigned OCI and reboot\nConditionPathExists=!/etc/ucore-autorebase/unverified\nConditionPathExists=!/etc/ucore-autorebase/signed\nConditionPathExists=/var/lib/base-packages-installed.stamp\n\nAfter=network-online.target\nWants=network-online.target\n[Service]\nType=oneshot\nStandardOutput=journal+console\nExecStart=/usr/bin/pip3 install vault-cli setuptools \nExecStart=/usr/bin/rpm-ostree rebase --bypass-driver ostree-unverified-registry:ghcr.io/ublue-os/ucore:stable\nExecStart=/usr/bin/touch /etc/ucore-autorebase/unverified\nExecStart=/usr/bin/systemctl disable ucore-unsigned-autorebase.service\nExecStart=/usr/bin/systemctl reboot\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"ucore-unsigned-autorebase.service"},{"contents":"[Unit]\nDescription=uCore autorebase to signed OCI and reboot\nConditionPathExists=/etc/ucore-autorebase/unverified\nConditionPathExists=!/etc/ucore-autorebase/verified\nConditionPathExists=/var/lib/base-packages-installed.stamp\nAfter=network-online.target\nWants=network-online.target\n[Service]\nType=oneshot\nStandardOutput=journal+console\nExecStart=/usr/bin/rpm-ostree rebase --bypass-driver ostree-image-signed:docker://ghcr.io/ublue-os/ucore:stable\nExecStart=/usr/bin/touch /etc/ucore-autorebase/signed\nExecStart=/usr/bin/systemctl disable ucore-signed-autorebase.service\nExecStart=/usr/bin/systemctl reboot\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"ucore-signed-autorebase.service"}]}}
