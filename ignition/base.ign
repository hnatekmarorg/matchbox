{"ignition":{"version":"3.4.0"},"passwd":{"users":[{"groups":["root"],"name":"root","sshAuthorizedKeys":["ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDFPly2MYEeh4FtFtftOa0qasGW4VNIzYv/ZzheQ/dFs martin@fedora"]}]},"storage":{"directories":[{"path":"/etc/ucore-autorebase","mode":492}],"files":[{"path":"/usr/local/bin/run-telegraf","contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/1JW1E/KzNNPSizO4OJKrSjILypRcA4NDvH3jQ/x93b1s1XRSE4sUdBPLUnWL0nNSU0vSkzTK8nPTs1TqFEoKVLQTVFQjylSh3NilDS5uPRLi4vAxsJ0KOjqJufnpWWmoxqkn1xaXJKfqws3GKSICxAAAP//r+PkO5MAAAA="},"mode":493},{"path":"/etc/telegraf/custom-telegraf.conf","contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/4xX224bydG+51MURj9gGzumSeP3jQAiyCoO4mRlG1kle2EI3OJMzUwv+zDbB1KjII+VF8iTBdXdc6Asb+ILQ+yprvqq+quvq79gS9rfr66u4A/UYJAeavQIlZGSKi+MBqE92RNKaIwFlBKE7oN3q2l9B8V24wr28VcTdO2e3e0NvBh/vGBbQSWIZjLYRSfgO9KA8ozD5AaMhuvNpoTrLf/3dlMC+Wq9shxsv4DhbaAVu74jSa3FBs5CSnCka1DkragcwzDBcwIgNBzQVx05MA2gB2Wc5+3Jdh8/7p14pHH3OjrvBEPT3hrpGC9EE9PA2QpPvIR+hsDRF2Ghl6EV2q1XX0fZwXaz2cQMbvFBqKBAB3Ugy86DZvee9JRKzx+i0zXAB11ZQid0C54BnlAGYk8opTm7eHjS6JYs7xOmjklnTLU5ay8UwVn4zvCCNX3PvsZY6DlT9lcZ53lrJ9qOLKgMVJEydoDgsKU5t9A0ZPdSKOFzdim9m5kgv3BSFoSD4KjmQuUVruyCSIcBECzq2ihAZYL28TTeY9XlmubTlkR94upoPqUmpnAHaoyd/et2cbSo4UATGjwZUYNCPYxHB78GskOutG4dSHEkcINrlnVyqChGLuHciaqLfjs8ESAoQhcsHiQBNU2meGTS4Dyp9WrOe58B76DgHntSPNM0jvyyeK4TjX+mdrzSihM311y8Zb7/Y8qV0c5bFNpDTSdRkYskSyGnnDmiQh1QygFc1VEdZCoYKe47tlmvrhYY9zmVRZ6jIDUyOC7010qUO3k9tUs0nSUhEuIQj+PJl+/yQqru6snXhaL9eSZjNJpBPEPIVFDhoLdCoRVymMrJviTalpJKgOvFkVJbBkfWgQ1ac5KYzebO96OUCO086oqSDrF+4shn08A7B6jrGd9245ho2iXg5FI5Oux70kAnsgNsN6+379xqWYtnmEazfKIliLqbmMJl6S1VwjHNXE+VaATVa/g8LYpIkOkTIMOExRH5blxgcfoOghYeXtK6XcPGlbDdKFfC2+BK+H/3Kmb+d5SiTjxj44Sq0K4ooQiugJfGQvHvf7niVQmFisuu4J28+fsB6kwsY+HM1w3zzpuYdrlIJ7Nn/DwSnJ1wbOdR9WBsTZaTetJyY4JlypC/jlJ5ID7nrbtmTxDPMcJ4Sr/nsBTbRMv076ttb99t1Lc2qriTN3++/Prx093U/cxHR5YbO9/za/iQBKbnIhDLrdC1OIk6oIxHuzSPEkRJDeYiZXnAvremtwL9gjXr1Qx2Qb0fTMvbajqEFiSdSLJepJ87aFA6Gs2MlgOQtXzDsSEocnwNcZvAr0FEVUk7xi2NsQr95S1+xmHaGRklTdsyYXU9aqTR8Z4vPD34omRnhfM2VD5YqgswtmQh/0no2pxdCQWdSHtpWiYfu8thd9lDuulTSDjSkKo/OeQdroyjw4msFTVFnBN7GyZ39H0FH1pteIto4Ocp0M98btr4C5QMZf65l6bd56z3DGEHRf6Z4H1kSWcRYgEUkhjOYaoNY2PINVnLsYPmwzcWSPV+SHqYOOJ9VHAHIiPlXNnpXKR8KmOtONgOigTjrqNpcaS0NR5Zm7AZFTpKwtQPCzmCn3Kfx+Y1sAFt8kWFTPvoKqkVj0cMJG77wbSj5qVYkWvcduxoHMi8iZOs78hSKjljBay8OAk/zN4VDgy8JokD1YtE96PJxR206f578kkCPByoMopcujy4GpgnirEI8RjEIy2KMVUiTp+/VYnnkCp8GMfWYnP7ffGNuXU6JVt14kRxFD4S9SXwfGEky6ccy1yTJB/jXcGHZsT4elsyyslDPBBS5vQbyCbjHbyLyD6L6ggYD/2R+9gbVrxUP2Yz05MpOfQEL6SpUL7IQ3PFr5c0sFzB+wdUvaRr+L0iKyp8c9OJCluTcOxZ7PdTjIm+n8YGHpu3M85rVOkJFJslojFu/af85eWr1dVkljxdFIUfOyXUJp5fVtyC7Qvw2MYhiztinB3iO4+rZZTw+4XfWRhvyXemjs1uUTuJsWV//Hj7GczhF6r4LrhJQlho8k6rvoCXNbF+8xG/SoNubLHsgByPSRXKOP3RgyerUUJvTWtROWAfk21U2rjCk3GUV77IW+OUKPIQvXAc8mOH4BCE9K+FhmgKUhws2iEKnVb9ftxj4mwzIv+mukmDdWodJi5/HYfgxvKoxyA9Px5mG29GxgZdGaVI+3xxsPrG4y3Ts+yih6eZnV8Fy4ixV/nvJsgpOj8RyCqhMY/+0xtzzZGnFOhBOB/NnUfrYx1n55kXl1pCMaFZk6c36gjjQov/KLGNsI+in8bW3pqKnDPWZT3GtrXUctXd5dhVXthyKwcNCI4qo/NU95WHNdx0qLlHUzbCTVdKboX8+GNIMdnkjV3zAU4BY0pH0e/npX2Mtl9Em7riy5c8A1V9uL+ff9bCHZ/+Fma5okgtf+Zo5JaL6bEXV8aHjNCNDA/1YX96e3+/AoBgpdt9KTrve3f95k36vu40ejoqtOuH4bGIht4cSe+K//vHzd9+vPt0u7/79Jf3H38XVyMJGx7a/1mwqbEtavEYabQrOqMoLh9CdSS/K5TRwhsrdFus/hMAAP//6YjlXx8SAAA="},"mode":420},{"path":"/etc/containers/registries.conf.d/mirrors.conf","contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/4zMMQ7CMAxG4T3H8N7coCepOljGJFZpDT9Bajg9AnYr83v6lgVa7NnQ1zXdXLiZHzPtBjimi8ummMxzPbjptjPy2d+U7tCrnTP9h2xOKcVUkcgpMobUWKljzOPFPWC++cd8AgAA//9TBVH8HQEAAA=="},"mode":420},{"path":"/etc/yum.repos.d/telegraf.repo","contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/4SMzcrCMBAA73mKfYE2fPBRROjNi1c9ipRtujYhvyRbad5eWpAePc4wzMOEl1vWCRmfIqAn6OG6qwsywo1SLIZjrtDAnXF0JEYstGQHPWjmVM5S5q1qj1Oropdlr+V66obuX3o0QVDY1AQ9/Ik5zUqTsl+wVH8dD2wwK23eNKjoE3JrqYpPAAAA//9U0uFgygAAAA=="},"mode":493},{"path":"/etc/profile.d/zz-defaults.sh","contents":{"compression":"","source":"data:,export%20EDITOR%3Dvim%0A"}},{"path":"/etc/profile.d/zz-openbao.sh","contents":{"compression":"","source":"data:,export%20VAULT_ADDR%3Dhttps%3A%2F%2Fopenbao.hnatekmar.xyz%0Aexport%20BAO_ADDR%3Dhttps%3A%2F%2Fopenbao.hnatekmar.xyz"},"mode":493},{"path":"/etc/proxy.env","contents":{"compression":"","source":"data:,http_proxy%3D%22http%3A%2F%2F172.16.100.61%3A3128%22"},"mode":420}],"links":[{"path":"/etc/localtime","target":"../usr/share/zoneinfo/Europe/Prague"}]},"systemd":{"units":[{"mask":true,"name":"docker.service"},{"contents":"[Unit]\nDescription=Retrieve token from Vault for telegraf\nConditionPathExists=/root/.vault-token\nConditionPathExists=!/etc/telegraf.token\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/bin/bash -c '/usr/bin/podman run -e BAO_ADDR=https://openbao.hnatekmar.xyz -e VAULT_TOKEN=$(cat /root/.vault-token) -ti quay.io/openbao/openbao kv get -format=json -field=influx_token secret/servers/common  \u003e /etc/telegraf.token'\n\n[Install]\nWantedBy=default.target\n","enabled":true,"name":"telegraf-env.service"},{"contents":"[Unit]\nDescription=The plugin-driven server agent for reporting metrics into InfluxDB\nDocumentation=https://github.com/influxdata/telegraf\nAfter=network.target\nConditionPathExists=/etc/telegraf.token\n\n[Service]\nType=simple\nExecStart=/bin/bash /usr/local/bin/run-telegraf\nRestart=on-failure\nStandardOutput=syslog\nStandardError=syslog\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"telegraf.service"},{"contents":"[Unit]\nDescription=Layer vim with rpm-ostree\nWants=network-online.target\nAfter=network-online.target\n\n# We run before `zincati.service` to avoid conflicting rpm-ostree\n# transactions.\nBefore=zincati.service\nConditionPathExists=!/var/lib/%N.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\n# `--allow-inactive` ensures that rpm-ostree does not return an error\n# if the package is already installed. This is useful if the package is\n# added to the root image in a future Fedora CoreOS release as it will\n# prevent the service from failing.\nExecStart=/usr/bin/rpm-ostree install --allow-inactive -y vim telegraf\nExecStart=/bin/touch /var/lib/%N.stamp\nExecStart=/bin/systemctl --no-block reboot\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"rpm-ostree-install-base.service"},{"dropins":[{"contents":"[Service]\nEnvironmentFile=/etc/proxy.env\n","name":"99-proxy.conf"}],"enabled":true,"name":"containerd.service"}]}}
